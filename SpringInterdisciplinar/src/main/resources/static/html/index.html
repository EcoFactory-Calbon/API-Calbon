<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Funcionários</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
<div class="container">
    <header>
        <h1>Gerenciamento de Funcionários</h1>
        <p class="description">Sistema para gerenciar o cadastro de funcionários</p>
    </header>

    <div id="alertBox"></div>

    <div class="card">
        <h2 class="card-title">Adicionar Novo Funcionário</h2>
        <form id="funcionarioForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" name="nome" required>
                </div>

                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="cargo">Cargo:</label>
                    <input type="text" id="cargo" name="cargo" required>
                </div>

                <div class="form-group">
                    <label for="salario">Salário:</label>
                    <input type="number" id="salario" name="salario" step="0.01" required>
                </div>
            </div>
            <button type="submit">Adicionar Funcionário</button>
        </form>
    </div>

    <div class="card">
        <h2 class="card-title">Lista de Funcionários</h2>
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando funcionários...</p>
        </div>
        <table id="funcionariosTable" style="display: none;">
            <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Cargo</th>
                <th>Salário</th>
                <th>Ações</th>
            </tr>
            </thead>
            <tbody id="funcionariosBody">
            <!-- Os dados dos funcionários serão inseridos aqui via JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<script>
    // URL base da API - altere se necessário
    const API_BASE_URL = 'http://localhost:8080/funcionario';

    // Elementos DOM
    const funcionarioForm = document.getElementById('funcionarioForm');
    const funcionariosBody = document.getElementById('funcionariosBody');
    const funcionariosTable = document.getElementById('funcionariosTable');
    const loadingElement = document.getElementById('loading');
    const alertBox = document.getElementById('alertBox');

    // Função para exibir mensagens de alerta
    function showAlert(message, type = 'success') {
        alertBox.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;

        // Remover o alerta após 5 segundos
        setTimeout(() => {
            alertBox.innerHTML = '';
        }, 5000);
    }

    // Função para buscar e exibir todos os funcionários
    async function loadFuncionarios() {
        try {
            loadingElement.style.display = 'block';
            funcionariosTable.style.display = 'none';

            const response = await fetch(`${API_BASE_URL}/listar`);

            if (!response.ok) {
                throw new Error('Erro ao carregar funcionários');
            }

            const funcionarios = await response.json();

            funcionariosBody.innerHTML = '';

            if (funcionarios.length === 0) {
                funcionariosBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center;">
                                Nenhum funcionário cadastrado.
                            </td>
                        </tr>
                    `;
            } else {
                funcionarios.forEach(funcionario => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                            <td>${funcionario.id}</td>
                            <td>${funcionario.nome || 'N/A'}</td>
                            <td>${funcionario.email || 'N/A'}</td>
                            <td>${funcionario.cargo || 'N/A'}</td>
                            <td>${funcionario.salario ? `R$ ${funcionario.salario.toFixed(2)}` : 'N/A'}</td>
                            <td class="actions">
                                <button class="btn-danger btn-action" onclick="deleteFuncionario(${funcionario.id})">
                                    Excluir
                                </button>
                            </td>
                        `;
                    funcionariosBody.appendChild(row);
                });
            }

            loadingElement.style.display = 'none';
            funcionariosTable.style.display = 'table';
        } catch (error) {
            console.error('Erro:', error);
            loadingElement.style.display = 'none';
            showAlert('Erro ao carregar funcionários. Verifique se a API está rodando.', 'error');
        }
    }

    // Função para adicionar um novo funcionário
    async function addFuncionario(funcionario) {
        try {
            const response = await fetch(`${API_BASE_URL}/adicionar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(funcionario)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || 'Erro ao adicionar funcionário');
            }

            const novoFuncionario = await response.json();
            showAlert('Funcionário adicionado com sucesso!');
            funcionarioForm.reset();
            loadFuncionarios(); // Recarregar a lista

            return novoFuncionario;
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro ao adicionar funcionário: ' + error.message, 'error');
        }
    }

    // Função para excluir um funcionário
    async function deleteFuncionario(id) {
        if (!confirm('Tem certeza que deseja excluir este funcionário?')) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/excluir/${id}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error('Erro ao excluir funcionário');
            }

            showAlert('Funcionário excluído com sucesso!');
            loadFuncionarios(); // Recarregar a lista
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro ao excluir funcionário. Verifique a conexão com a API.', 'error');
        }
    }

    // Event Listener para o formulário
    funcionarioForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const funcionario = {
            nome: document.getElementById('nome').value,
            email: document.getElementById('email').value,
            cargo: document.getElementById('cargo').value,
            salario: parseFloat(document.getElementById('salario').value)
        };

        addFuncionario(funcionario);
    });

    // Carregar funcionários quando a página for carregada
    document.addEventListener('DOMContentLoaded', function() {
        loadFuncionarios();
    });
</script>
</body>
</html>